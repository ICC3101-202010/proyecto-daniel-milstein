using System;using System.Collections.Generic;using System.Diagnostics;using System.IO;using System.Runtime.Serialization;using System.Runtime.Serialization.Formatters.Binary;using System.Threading;using System.Windows.Forms;namespace Proyecto{    [Serializable]    public static class Spotflix    {        private static Dictionary<string, User> UserDB;        private static List<Media> MediaDB;        private static Dictionary<string, Artist> PeopleDB;                static Spotflix()        {
            Dictionary<string, User> userDB = null;
            List<Media> mediaDB = null;
            Dictionary<string, Artist> peopleDB = null;

            try
            {
                var load = Load("Spotflix.bin");

                userDB = load.Item1;
                mediaDB = load.Item2;
                peopleDB = load.Item3;

            }
            catch (Exception)
            {
                userDB = new Dictionary<string, User>();
                mediaDB = new List<Media>();
                peopleDB = new Dictionary<string, Artist>();
                User admin = new User("admin", "dnmilstein@miuandes.cl", "admin", true, true, true);
                userDB.Add("admin", admin);
            }                        UserDB = userDB;            MediaDB = mediaDB;            PeopleDB = peopleDB;                    }                public static Dictionary<string, Artist> GetPeopleDB        {            get            {                return PeopleDB;            }        }        public static List<Media> GetMediaDB { get { return MediaDB; } }        public static void SetMediaDB(List<Media> mediaDB) { mediaDB = MediaDB; }        public static void SetUserDB(Dictionary<string, User> userDB) { userDB = UserDB; }        public static void AddPerson(Artist person)        {            PeopleDB.Add(person.GetName(), person);        }        public static void SaveMedia(Media media)        {            MediaDB.Add(media);        }        public static void AddUser(User user)        {            UserDB.Add(user.GetUsername(), user);        }        public static Dictionary<string, User> GetUserDB        {            get            {                return UserDB;            }        }        public static void ImportMedia(Media media)        {            //Media a = new Media();            MediaDB.Add(media);        }        public static string LogIn(string username, string password)        {            User user = UserDB[username];            try            {                if (user.GetPassword() == password)                {                    return username;                }                else                {                    return "";                }            }            catch (Exception)            {                return "";            }        }        public static string AdminLogIn(string username, string password)        {            string admin = LogIn(username, password);            User user = UserDB[admin];            if (user.GetAdmin() == true)            {                return username;            }            else            {                return "";            }        }               public static void Save(string name)        {            Stream stream = new FileStream(name, FileMode.OpenOrCreate, FileAccess.ReadWrite, FileShare.None);            IFormatter formatter = new BinaryFormatter();            formatter.Serialize(stream, UserDB);            formatter.Serialize(stream, MediaDB);            formatter.Serialize(stream, PeopleDB);            stream.Close();        }        public static (Dictionary<string, User>, List<Media>, Dictionary<string, Artist>) Load(string name)        {            Stream stream = new FileStream(name, FileMode.OpenOrCreate, FileAccess.ReadWrite, FileShare.None);            IFormatter formatter = new BinaryFormatter();            Dictionary<string, User> userDB = (Dictionary<string, User>)formatter.Deserialize(stream);            List<Media> mediaDB = (List<Media>)formatter.Deserialize(stream);            Dictionary<string, Artist> peopleDB = (Dictionary<string, Artist>)formatter.Deserialize(stream);            stream.Close();            return (userDB, mediaDB, peopleDB);        }    }}